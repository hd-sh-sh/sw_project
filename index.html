<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NASA SpaceWeather Intelligence - Side Rail Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.0/lucide.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=JetBrains+Mono:wght@500;800&display=swap');
        
        :root {
            --bg-color: #010409;
            --aurora-1: rgba(0, 82, 165, 0.2);
            --aurora-2: rgba(16, 185, 129, 0.1);
            --sidebar-width: 70px;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-color);
            color: #f8fafc; 
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 1s ease;
        }

        /* 동적 오로라 배경 */
        #aurora-bg {
            position: fixed;
            inset: 0;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }

        .aurora-layer {
            position: absolute;
            width: 150%;
            height: 150%;
            top: -25%;
            left: -25%;
            filter: blur(80px);
            opacity: 0.5;
            transition: all 1.5s ease;
        }

        .glow-1 {
            background: radial-gradient(circle at 20% 30%, var(--aurora-1) 0%, transparent 50%);
            animation: drift 20s infinite alternate;
        }

        .glow-2 {
            background: radial-gradient(circle at 80% 70%, var(--aurora-2) 0%, transparent 50%);
            animation: drift 25s infinite alternate-reverse;
        }

        @keyframes drift {
            from { transform: translate(-5%, -5%) rotate(0deg); }
            to { transform: translate(5%, 5%) rotate(5deg); }
        }

        /* 상태별 컬러 테마 */
        body.lvl-1 { --aurora-1: rgba(16, 185, 129, 0.2); --aurora-2: rgba(59, 130, 246, 0.2); }
        body.lvl-2 { --aurora-1: rgba(59, 130, 246, 0.2); --aurora-2: rgba(45, 212, 191, 0.2); }
        body.lvl-3 { --aurora-1: rgba(234, 179, 8, 0.15); --aurora-2: rgba(16, 185, 129, 0.15); }
        body.lvl-4 { --aurora-1: rgba(249, 115, 22, 0.2); --aurora-2: rgba(124, 58, 237, 0.15); }
        body.lvl-5 { --aurora-1: rgba(220, 38, 38, 0.3); --aurora-2: rgba(30, 41, 59, 0.5); }

        .glass { 
            background: rgba(13, 17, 23, 0.6); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
        }

        /* 사이드 내비게이션 스타일 */
        .side-rail {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: var(--sidebar-width);
            background: rgba(1, 4, 9, 0.9);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 50;
            display: flex;
            flex-col: column;
            align-items: center;
            padding: 20px 0;
        }

        .nav-item {
            position: relative;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            color: #64748b;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            border-radius: 12px;
        }

        .nav-item.active {
            color: #60a5fa;
            background: rgba(96, 165, 250, 0.1);
            box-shadow: inset 0 0 10px rgba(96, 165, 250, 0.1);
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            left: -13px;
            width: 3px;
            height: 18px;
            background: #60a5fa;
            border-radius: 0 4px 4px 0;
            box-shadow: 2px 0 10px rgba(96, 165, 250, 0.5);
        }

        .tech-card { position: relative; overflow: hidden; }
        .tech-card::before {
            content: '';
            position: absolute;
            top: 10px; left: 10px;
            width: 6px; height: 6px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }

        .scanline {
            width: 100%; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            position: absolute; top: 0;
            animation: scan 4s linear infinite;
        }
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }

        .status-pulse { animation: status-pulse 3s infinite ease-in-out; }
        @keyframes status-pulse { 
            0%, 100% { transform: scale(1); filter: brightness(1); } 
            50% { transform: scale(1.02); filter: brightness(1.2); } 
        }

        .page-transition { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .mono { font-family: 'JetBrains Mono', monospace; }
        
        main {
            padding-left: calc(var(--sidebar-width) + 16px);
            padding-right: 16px;
            padding-top: 80px;
        }

        @media (max-width: 640px) {
            :root { --sidebar-width: 60px; }
            main { padding-left: calc(var(--sidebar-width) + 12px); }
        }

        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="min-h-screen flex flex-col select-none lvl-1">

    <!-- 동적 배경 -->
    <div id="aurora-bg">
        <div class="aurora-layer glow-1"></div>
        <div class="aurora-layer glow-2"></div>
        <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(white 1px, transparent 1px); background-size: 40px 40px;"></div>
    </div>

    <!-- 사이드 레일 내비게이션 -->
    <aside class="side-rail">
        <!-- 로고 버튼 -->
        <button onclick="navigateTo('home')" class="mb-10 mt-2">
            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-700 rounded-xl flex items-center justify-center shadow-lg shadow-blue-900/40">
                <i data-lucide="satellite" class="w-6 h-6 text-white"></i>
            </div>
        </button>

        <nav class="flex flex-col gap-4">
            <button onclick="navigateTo('home')" id="rail-home" class="nav-item active" title="Dashboard">
                <i data-lucide="layout-grid" class="w-6 h-6"></i>
            </button>
            <button onclick="navigateTo('details')" id="rail-details" class="nav-item" title="Logs">
                <i data-lucide="activity" class="w-6 h-6"></i>
            </button>
            <button onclick="navigateTo('info')" id="rail-info" class="nav-item" title="Library">
                <i data-lucide="book-open" class="w-6 h-6"></i>
            </button>
        </nav>

        <div class="mt-auto mb-6 flex flex-col gap-4">
            <button onclick="toggleAppMode()" class="nav-item">
                <i data-lucide="zap" id="modeIcon" class="w-5 h-5 text-blue-400"></i>
            </button>
            <button onclick="toggleSettings()" class="nav-item">
                <i data-lucide="settings" class="w-5 h-5"></i>
            </button>
        </div>
    </aside>

    <!-- 고정 헤더 (제목 영역) -->
    <header class="fixed top-0 left-0 right-0 z-40 flex items-center h-20 px-6 pointer-events-none">
        <div class="flex flex-col ml-[var(--sidebar-width)] pointer-events-auto" style="margin-left: var(--sidebar-width);">
            <span class="font-black text-[10px] tracking-[0.3em] uppercase text-white/40">SpaceWeather Intel</span>
            <h1 id="screenTitle" class="text-xl font-black uppercase tracking-tight">Observation Dash</h1>
        </div>
        
        <div id="loadingIndicator" class="hidden ml-auto mr-4 text-blue-500 text-[10px] font-black animate-pulse flex items-center gap-2 bg-black/40 px-3 py-1.5 rounded-full border border-white/5">
            <i data-lucide="refresh-cw" class="w-3 h-3 animate-spin"></i> SYNC
        </div>
    </header>

    <!-- 설정 패널 -->
    <div id="settingsPanel" class="hidden glass fixed top-24 left-[80px] right-4 z-[60] p-6 rounded-[2rem] border-white/10 shadow-2xl page-transition max-w-sm">
        <h4 class="text-xs font-black uppercase tracking-widest mb-4 flex items-center gap-2"><i data-lucide="key" class="w-3 h-3"></i> NASA API Access</h4>
        <input type="password" id="apiKeyInput" value="DEMO_KEY" class="w-full bg-black/50 border border-white/10 text-sm px-4 py-4 rounded-xl outline-none text-blue-400 mb-3 mono" placeholder="NASA API KEY">
        <button onclick="applyNewApiKey()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-black text-xs uppercase tracking-widest">Update Telemetry</button>
    </div>

    <!-- 메인 콘텐츠 -->
    <main class="flex-grow pb-12">
        
        <!-- 대시보드 섹션 -->
        <section id="page-home" class="page-transition">
            
            <div class="text-center mb-12 relative">
                <div id="statusHero" class="relative inline-block">
                    <!-- HUD 장식 -->
                    <div class="absolute -inset-6 border border-white/5 rounded-full animate-[spin_20s_linear_infinite] opacity-30"></div>
                    <div class="absolute -inset-10 border border-dashed border-white/10 rounded-full animate-[spin_40s_linear_infinite_reverse] opacity-10"></div>
                    
                    <div class="relative bg-black/30 backdrop-blur-3xl px-8 py-10 rounded-full flex flex-col items-center justify-center min-w-[220px] min-h-[220px] border border-white/10 shadow-[0_0_60px_rgba(0,0,0,0.5)]">
                        <div id="statusIcon" class="mb-4 status-pulse text-blue-400 drop-shadow-[0_0_15px_rgba(59,130,246,0.3)]">
                            <i data-lucide="shield-check" class="w-14 h-14"></i>
                        </div>
                        <h3 id="statusLevelText" class="text-2xl font-black mb-1 uppercase tracking-tight">Steady</h3>
                        <p id="statusDescText" class="text-gray-500 text-[9px] max-w-[140px] leading-relaxed font-bold uppercase opacity-50">Observation Nominal</p>
                    </div>
                </div>
                
                <div class="flex justify-center gap-1.5 mt-8">
                    <div class="h-1 w-8 rounded-full bg-white/5 transition-all duration-700" id="step-1"></div>
                    <div class="h-1 w-8 rounded-full bg-white/5 transition-all duration-700" id="step-2"></div>
                    <div class="h-1 w-8 rounded-full bg-white/5 transition-all duration-700" id="step-3"></div>
                    <div class="h-1 w-8 rounded-full bg-white/5 transition-all duration-700" id="step-4"></div>
                    <div class="h-1 w-8 rounded-full bg-white/5 transition-all duration-700" id="step-5"></div>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="glass tech-card p-6 rounded-[2rem] active:scale-95 transition-all" onclick="showMetricInfo('FLR')">
                    <div class="scanline"></div>
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-2.5 bg-yellow-500/10 rounded-xl text-yellow-500 border border-yellow-500/20"><i data-lucide="sun" class="w-5 h-5"></i></div>
                        <i data-lucide="info" class="w-3.5 h-3.5 text-gray-700"></i>
                    </div>
                    <span id="flrCount" class="text-4xl font-black mono tracking-tighter text-yellow-500">0</span>
                    <p class="text-[9px] text-gray-500 uppercase font-black tracking-widest mt-1">Solar Flares</p>
                </div>
                
                <div class="glass tech-card p-6 rounded-[2rem] active:scale-95 transition-all" onclick="showMetricInfo('CME')">
                    <div class="scanline"></div>
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-2.5 bg-blue-500/10 rounded-xl text-blue-500 border border-blue-500/20"><i data-lucide="zap" class="w-5 h-5"></i></div>
                        <i data-lucide="info" class="w-3.5 h-3.5 text-gray-700"></i>
                    </div>
                    <span id="cmeCount" class="text-4xl font-black mono tracking-tighter text-blue-500">0</span>
                    <p class="text-[9px] text-gray-500 uppercase font-black tracking-widest mt-1">CME Events</p>
                </div>

                <div class="glass tech-card p-6 rounded-[2rem] col-span-1 sm:col-span-2 active:scale-95 transition-all" onclick="showMetricInfo('GST')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="p-3 bg-purple-500/10 rounded-2xl text-purple-500 border border-purple-500/20"><i data-lucide="activity" class="w-6 h-6"></i></div>
                            <div>
                                <p class="text-xs font-black text-gray-200 uppercase tracking-widest">Geomagnetic Alert</p>
                                <p class="text-[9px] text-gray-600 font-bold uppercase tracking-tighter">Magnetic Stability</p>
                            </div>
                        </div>
                        <span id="gstCount" class="text-4xl font-black mono tracking-tighter text-purple-500">0</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 로그 섹션 -->
        <section id="page-details" class="hidden page-transition">
            <div class="flex items-center justify-between mb-6">
                <p id="dateRangeInfo" class="text-[10px] text-blue-500/60 font-black mono"></p>
                <button onclick="fetchAllData(true)" class="text-[9px] font-black uppercase text-gray-500 hover:text-white transition-colors">Refresh</button>
            </div>
            <div id="eventList" class="flex flex-col gap-3"></div>
        </section>

        <!-- 정보 섹션 -->
        <section id="page-info" class="hidden page-transition">
            <div class="flex flex-col gap-4">
                <div class="glass p-6 rounded-[2rem] border-white/5 relative overflow-hidden">
                    <div class="w-10 h-10 bg-blue-600/10 rounded-xl flex items-center justify-center mb-4 text-blue-400 border border-blue-600/20"><i data-lucide="sun" class="w-5 h-5"></i></div>
                    <h3 class="text-lg font-black mb-2 uppercase tracking-tight">Solar Flares</h3>
                    <p class="text-gray-400 text-[10px] leading-relaxed font-medium">태양 표면에서 발생하는 강렬한 에너지 방출입니다. X선 및 전자기파가 지구 통신 장비에 영향을 미칠 수 있습니다.</p>
                </div>
                <div class="glass p-6 rounded-[2rem] border-white/5 relative overflow-hidden">
                    <div class="w-10 h-10 bg-purple-600/10 rounded-xl flex items-center justify-center mb-4 text-purple-400 border border-purple-600/20"><i data-lucide="waves" class="w-5 h-5"></i></div>
                    <h3 class="text-lg font-black mb-2 uppercase tracking-tight">CME Events</h3>
                    <p class="text-gray-400 text-[10px] leading-relaxed font-medium">코로나 질량 방출은 거대한 플라스마 구름이 우주로 뿜어지는 현상으로, 오로라 생성 및 전력망 간섭의 원인이 됩니다.</p>
                </div>
            </div>
        </section>
    </main>

    <!-- 측정 정보 모달 -->
    <div id="infoModalOverlay" class="hidden fixed inset-0 z-[100] bg-black/80 backdrop-blur-md flex items-center justify-center p-6">
        <div id="infoModalBody" class="w-full max-w-sm glass rounded-[3rem] p-8 border-white/20 shadow-2xl modal-fade-in relative overflow-hidden">
            <div class="scanline opacity-20"></div>
            <div id="infoModalIcon" class="w-16 h-16 rounded-[1.5rem] flex items-center justify-center mb-6 shadow-inner"></div>
            <h3 id="infoModalTitle" class="text-xl font-black mb-3 uppercase tracking-tight"></h3>
            <p id="infoModalDesc" class="text-gray-400 text-[11px] leading-relaxed mb-8 font-medium"></p>
            <div class="flex flex-col gap-3">
                <button onclick="goToDetailsFromModal()" class="py-4 bg-blue-600 rounded-2xl text-[10px] font-black text-white uppercase tracking-widest active:scale-95 transition-all">View Logs</button>
                <button onclick="closeInfoModal()" class="py-4 bg-white/5 rounded-2xl text-[10px] font-black text-gray-500 border border-white/5 uppercase tracking-widest">Dismiss</button>
            </div>
        </div>
    </div>

    <script>
        const MOCK_DATA = {
            flr: [{ beginTime: "2024-05-14T02:13Z", classType: "X8.7", sourceLocation: "N14W90" }, { beginTime: "2024-05-10T17:44Z", classType: "X5.8", sourceLocation: "N15E88" }, { beginTime: "2024-05-08T09:12Z", classType: "M8.4", sourceLocation: "N20E40" }],
            cme: [{ startTime: "2024-05-10T18:00Z", cmeAnalyses: [{ speed: 1200 }] }, { startTime: "2024-05-07T22:15Z", cmeAnalyses: [{ speed: 700 }] }],
            gst: [{ startTime: "2024-05-11T00:00Z", allKpIndex: [{ kpRating: 9 }] }]
        };

        const METRIC_HELP = {
            'FLR': { title: 'Solar Flare', desc: '태양 플레어는 강력한 전자기 방출입니다. 지구의 무선 통신 및 GPS 정확도에 직접적인 영향을 줄 수 있는 주요 지표입니다.', color: 'bg-yellow-500/10 text-yellow-500', icon: 'sun' },
            'CME': { title: 'CME Tracking', desc: '코로나 질량 방출(CME)은 막대한 양의 자성 플라스마가 방출되는 것입니다. 지구 인프라 손상을 야기할 수 있는 위험 요소입니다.', color: 'bg-blue-500/10 text-blue-500', icon: 'zap' },
            'GST': { title: 'Geomagnetic Storm', desc: '지자기 폭풍은 지구 자기장의 급격한 요동을 의미합니다. 전력망 시스템 안전을 위해 정밀하게 모니터링됩니다.', color: 'bg-purple-500/10 text-purple-500', icon: 'activity' }
        };

        const CACHE_KEY = "sw_side_v5_cache";
        const CACHE_TIME = 15 * 60 * 1000;

        let appState = { currentPage: 'home', data: { flr: [], cme: [], gst: [] }, isLoading: false, appMode: 'REALTIME', apiKey: 'DEMO_KEY' };

        function navigateTo(pageId) {
            appState.currentPage = pageId;
            const titles = { 'home': 'Observation Dash', 'details': 'Telemetry Logs', 'info': 'Phenomena Lib' };
            document.getElementById('screenTitle').innerText = titles[pageId];

            ['home', 'details', 'info'].forEach(id => {
                const el = document.getElementById(`page-${id}`);
                const rail = document.getElementById(`rail-${id}`);
                if (el) el.classList.toggle('hidden', id !== pageId);
                if (rail) rail.classList.toggle('active', id === pageId);
            });
            window.scrollTo({ top: 0, behavior: 'smooth' });
            initIcons();
        }

        function showMetricInfo(type) {
            const info = METRIC_HELP[type];
            const overlay = document.getElementById('infoModalOverlay');
            const iconBox = document.getElementById('infoModalIcon');
            document.getElementById('infoModalTitle').innerText = info.title;
            document.getElementById('infoModalDesc').innerText = info.desc;
            iconBox.className = `w-16 h-16 rounded-[1.5rem] flex items-center justify-center mb-6 border border-white/5 ${info.color}`;
            iconBox.innerHTML = `<i data-lucide="${info.icon}" class="w-8 h-8"></i>`;
            overlay.classList.remove('hidden');
            initIcons();
        }

        function closeInfoModal() { document.getElementById('infoModalOverlay').classList.add('hidden'); }
        function goToDetailsFromModal() { closeInfoModal(); navigateTo('details'); }
        function toggleSettings() { document.getElementById('settingsPanel').classList.toggle('hidden'); }
        
        function toggleAppMode() {
            appState.appMode = appState.appMode === 'REALTIME' ? 'DEMO' : 'REALTIME';
            const icon = document.getElementById('modeIcon');
            icon.className = `w-5 h-5 transition-all ${appState.appMode === 'REALTIME' ? 'text-blue-400' : 'text-yellow-400'}`;
            icon.setAttribute('data-lucide', appState.appMode === 'REALTIME' ? 'zap' : 'test-tube-2');
            fetchAllData(true);
        }

        async function fetchAllData(force = false) {
            if (appState.isLoading) return;
            appState.isLoading = true;
            document.getElementById('loadingIndicator').classList.remove('hidden');

            if (appState.appMode === 'DEMO') {
                setTimeout(() => {
                    appState.data = JSON.parse(JSON.stringify(MOCK_DATA));
                    finalizeDataLoad("2024-05-01", "2024-05-20");
                }, 800);
                return;
            }

            const apiKey = appState.apiKey;
            const past = new Date(); past.setDate(past.getDate() - 30);
            const start = past.toISOString().split('T')[0];
            const end = new Date().toISOString().split('T')[0];

            try {
                const fetchNASA = async (type) => {
                    const r = await fetch(`https://api.nasa.gov/DONKI/${type}?startDate=${start}&endDate=${end}&api_key=${apiKey}`);
                    return r.ok ? await r.json() : [];
                };
                const [flr, cme, gst] = await Promise.all([fetchNASA('FLR'), fetchNASA('CME'), fetchNASA('GST')]);
                appState.data = { flr: Array.isArray(flr) ? flr : [], cme: Array.isArray(cme) ? cme : [], gst: Array.isArray(gst) ? gst : [] };
                finalizeDataLoad(start, end);
            } catch (e) {
                appState.appMode = 'DEMO';
                appState.data = JSON.parse(JSON.stringify(MOCK_DATA));
                finalizeDataLoad("2024-05-01", "2024-05-20");
            }
        }

        function finalizeDataLoad(start, end) {
            appState.isLoading = false;
            document.getElementById('loadingIndicator').classList.add('hidden');
            const rangeEl = document.getElementById('dateRangeInfo');
            if (rangeEl) rangeEl.innerText = `${start.replace(/-/g,'.')} ~ ${end.replace(/-/g,'.')}`;
            updateDashboard();
            renderEventList();
            calculateLevel();
            initIcons();
        }

        function updateDashboard() {
            document.getElementById('flrCount').innerText = appState.data.flr.length;
            document.getElementById('cmeCount').innerText = appState.data.cme.length;
            document.getElementById('gstCount').innerText = appState.data.gst.length;
        }

        function calculateLevel() {
            const { flr, gst } = appState.data;
            const hasX = flr.some(e => e.classType?.startsWith('X'));
            const kpMax = Math.max(...(gst.flatMap(g => g.allKpIndex?.map(k => k.kpRating) || [0])));

            let level = 1;
            let info = { text: "Steady", desc: "Minimal Activity", color: "text-blue-400", icon: "shield-check" };

            if (kpMax >= 8) { level = 5; info = { text: "CRITICAL", desc: "Magnetic Storm", color: "text-red-500", icon: "alert-octagon" }; }
            else if (hasX) { level = 4; info = { text: "UNSTABLE", desc: "X-Class Flare Alert", color: "text-orange-500", icon: "zap" }; }
            else if (flr.length > 5 || kpMax >= 6) { level = 3; info = { text: "ACTIVE", desc: "Elevated Activity", color: "text-yellow-400", icon: "sun" }; }
            else if (flr.length > 0) { level = 2; info = { text: "NOMINAL", desc: "Standard State", color: "text-emerald-400", icon: "activity" }; }

            document.body.className = `min-h-screen flex flex-col select-none lvl-${level}`;
            const iconC = document.getElementById('statusIcon');
            iconC.className = `mb-4 status-pulse ${info.color} drop-shadow-[0_0_20px_currentColor]`;
            iconC.innerHTML = `<i data-lucide="${info.icon}" class="w-14 h-14"></i>`;
            document.getElementById('statusLevelText').innerText = info.text;
            document.getElementById('statusLevelText').className = `text-2xl font-black mb-1 uppercase tracking-tight ${info.color}`;
            document.getElementById('statusDescText').innerText = info.desc;

            for(let i=1; i<=5; i++) {
                const s = document.getElementById(`step-${i}`);
                if (s) s.className = `h-1 w-8 rounded-full transition-all duration-700 ${i <= level ? info.color.replace('text', 'bg') + ' shadow-[0_0_10px_currentColor]' : 'bg-white/5'}`;
            }
        }

        function renderEventList() {
            const list = document.getElementById('eventList');
            let events = [];
            appState.data.flr.forEach(e => events.push({ ...e, type: 'FLR', time: new Date(e.beginTime) }));
            appState.data.cme.forEach(e => events.push({ ...e, type: 'CME', time: new Date(e.startTime) }));
            appState.data.gst.forEach(e => events.push({ ...e, type: 'GST', time: new Date(e.startTime) }));
            events.sort((a, b) => b.time - a.time);

            if (events.length === 0) {
                list.innerHTML = '<div class="p-20 text-center text-gray-700 text-[10px] font-black uppercase tracking-widest">No Records</div>';
                return;
            }

            list.innerHTML = events.slice(0, 15).map(ev => {
                let ic = "sun", cl = "text-yellow-500", t = ev.type, d = "";
                if (ev.type === 'FLR') { ic = "flame"; cl = "text-orange-500"; t = `Flare (${ev.classType})`; d = ev.sourceLocation || 'UNC'; }
                else if (ev.type === 'CME') { ic = "zap"; cl = "text-blue-500"; t = "CME Emission"; d = `${ev.cmeAnalyses?.[0]?.speed || '---'} km/s`; }
                else if (ev.type === 'GST') { ic = "activity"; cl = "text-purple-500"; t = "Geomagnetic"; d = `Kp: ${ev.allKpIndex?.[0]?.kpRating || '---'}`; }

                return `
                    <div class="glass p-5 rounded-[2rem] flex items-center justify-between border-white/5 tech-card overflow-hidden">
                        <div class="flex items-center gap-4">
                            <div class="p-3.5 bg-black/40 rounded-2xl ${cl} border border-white/5"><i data-lucide="${ic}" class="w-5 h-5"></i></div>
                            <div><p class="text-xs font-black text-gray-200 uppercase tracking-tight">${t}</p><p class="text-[9px] text-gray-600 font-black uppercase mt-1 tracking-widest">${d}</p></div>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] text-gray-400 font-black mono">${ev.time.getMonth()+1}/${ev.time.getDate()}</p>
                            <p class="text-[9px] text-gray-700 font-black mono uppercase mt-1">${ev.time.getHours()}:${String(ev.time.getMinutes()).padStart(2,'0')}</p>
                        </div>
                    </div>
                `;
            }).join('');
            initIcons();
        }

        function initIcons() { if (typeof lucide !== 'undefined') lucide.createIcons(); }
        window.onload = () => { fetchAllData(); document.getElementById('infoModalOverlay').addEventListener('click', function(e) { if(e.target === this) closeInfoModal(); }); };
    </script>
</body>
</html>
